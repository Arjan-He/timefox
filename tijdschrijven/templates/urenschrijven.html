{% extends "base.html" %}
{% block title %}<title>TimeFox - Tijdschrijven</title>{% endblock %}

{% block extracss %}
{% load static %}
<link rel="stylesheet" href="{% static 'plugins/jquery-ui-1.12.1/jquery-ui-flick.css' %}">
<link rel="stylesheet" href="{% static 'plugins/datatables/datatables-1.10.23.min.css' %}">
{% endblock %}

{% block extrajs %}
<script src="{% static 'plugins/datatables/datatables-1.10.23.min.js' %}"></script>
<script src="{% static 'plugins/jquery-ui-1.12.1/jquery-ui.min.js' %}"></script>
<script src="{% static 'plugins/weekpicker/jquery.weekpicker.js' %}"></script>
<script src="{% static 'js/functions.js' %}"></script>

{% endblock %}


{% block content %}

<h1>Tijdschrijven</h1>

<form method="POST" id='formGrid' action="{% url 'urenschrijven' %}">
  {% csrf_token %}

<input type="text" id="weekPicker" value="{{ datum }}">

<table class="table" id="tijdgrid">


    {# first the header and footer #}
    <thead class="thead-light">
      <tr>
        <th class="ts-headtitle">Project</th>
        {% for day in dagenindeweek %}
        <th class="ts-headdow">{{ day }}</th>
        {% endfor %}
        <th class="ts-headtotaal">totaal</th>
      </tr>
    </thead>

    <tfoot>
      <tr>
        <th class='ts-totaal'>Totaal</th>
        {% for day in dagenindeweek %}
        <th class='ts-totaal'>
          <input type='number' class="ts-urenvak ts-dagtotaal" weekdag="{{ forloop.counter0 }}" disabled>
        </th>
        {% endfor %}
        <th class='ts-totaal'>
          <input type='number' class="ts-urenvak ts-eindtotaal" disabled>
        </th>
      </tr>
    </tfoot>
    <tbody>
    {# end header and footer #}

    {% for i in tijdgrid %}

      {# close the open tablerow  but not at beginning loop (no row present)  #}
          {% ifchanged i.activiteitID %}
            {% if not forloop.first %}
              <td></td></tr>
            {% endif %}
          {% endifchanged %}

          {% ifchanged i.groepID %}
          {% if not forloop.first %}
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
          {% endif %}
            <tr>
              <td class='ts-groeptitle'>groep</td>
              {% for day in dagenindeweek %}
                <td></td>
              {% endfor %}
              <td></td>
            </tr>
          {% endifchanged %}

          {% ifchanged i.projectID %}
            <tr id='p-{{ i.projectID }}''>
            <td class='ts-projecttitle'>{{ i.titel }}</td>
            {% for day in dagenindeweek %}
              <td></td>
            {% endfor %}
            <td class='ts-totaal'>
                <input type="number" class="ts-urenvak ts-abonnementtotaal" abonnement="14" disabled>
            </td>
            </tr>
          {% endifchanged %}

          {% ifchanged i.projectactiviteitID %}
            <tr id='a-{{ i.projectID }}-{{ i.activiteitID }}' class='ts-rijactiviteit p-{{ i.projectID }}'>
              <td class='ts-activiteittitel'>{{ i.activiteit }}</td>
          {% endifchanged %}

          <td class='ts-gridcell' style='padding:0'>
            <input class="ts-urenvak" 
                  type="number" 
                  min="0"
                  max="24"
                  step="0.01"
                  id="{{ i.projectactiviteitID }}-{{ forloop.counter0 }}" 
                  abonnementdag = "{{ i.projectactiviteitID }}"
                  dagnummer = "{{ i.id }}"
                  name="cell_{{ i.projectactiviteitID }}_{% if i.tijdID == None %}0{% else %}{{ i.tijdID }}{% endif %}_{{ i.datum|date:'Y-m-d' }}"
                  originalvalue="{% if i.tijdsduur == None %}{% else %}{{ i.tijdsduur }}{% endif %}"
                  value="{% if i.tijdsduur == None %}{% else %}{{ i.tijdsduur }}{% endif %}">
          </td>

          {% if forloop.last %}
            <td></td></tr>
          {% endif %}

    {% endfor %}


    </tbody>
    </table>



    <input type="submit" name='saveGrid' value="Submit">

</form>

{% endblock %}